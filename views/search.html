{% extends 'layout.html' %}

{% block head %}
  <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyD4RhZKP0SgIHqX5CLbBZR4Au1NXs89AYQ'>
  </script>
{% endblock %}

{% block body %}
  <div class='row percent-contain'>
    <div class='col-md-12'>
      <div class='percent-block'>
        <p class='percent-question'>
          What're the chances of a meteorite hitting you?</p>
        <p class='percent'>
          {{ percentageByDistance * 100 }}%
        </p>
        <p class='percent'>
          {{ percentageByMass * 100 }} %
        </p>
      </div>
    </div>
  </div>
  <div class='row map-contain'>
    <div class='col-md-12 map-height'>
      <div id='map-geographic-canvas' class='map'></div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  var MAP_GEOGRAPHIC_CANVAS_ID = 'map-geographic-canvas';
  var MAX_METEOR_DISPLAY_SIZE = 10000;
  var MIN_METEOR_DISPLAY_SIZE = 1000;

  google.maps.event.addDomListener(window, 'load', function() {
    var geographic_map = new google.maps.Map(
      document.getElementById(MAP_GEOGRAPHIC_CANVAS_ID),
      {
        center: new google.maps.LatLng({{ lat }}, {{ lng }}),
        streetViewControl: false,
        zoom: 13
      }
    );
    var nearby = {{ JSON.stringify(nearbyMeteors) }};
    for (var meteor in nearby) {
      var meteorCircle = new google.maps.Circle({
        strokeColor: '#FF0000',
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: '#FF0000',
        fillOpacity: 0.35,
        map: geographic_map,
        center: {
          lat: parseFloat(nearby[meteor].latitude),
          lng: parseFloat(nearby[meteor].longitude)
        },
        radius: bound(nearby[meteor].mass,
                      MIN_METEOR_DISPLAY_SIZE,
                      MAX_METEOR_DISPLAY_SIZE)
      });
    }
  });
</script>
{% endblock %}
